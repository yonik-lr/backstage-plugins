---
apiVersion: scaffolder.backstage.io/v1beta3
kind: Template
metadata:
  name: start-ec2-instance
  title: Start EC2 Instance
  description: Start EC2 Instance
spec:
  owner: devops
  type: service

  parameters:
    - title: Env Type
      properties:
        envType:
          title: Env Type
          type: string
          enum:
            - 'stage'
            - 'dev'
            - 'qa'
            - 'stress'
          default: 'stage'
          description: The environment type you want to start the instance in
          ui:autofocus: true
          ui:options:
            rows: 1
    - title: EC2 Instances
      properties:
        instanceNames:
          title: Instance Names
          type: string
          default: 'yoni-devops'
          description: The names of the instances you want to start
          ui:autofocus: true
          ui:options:
            rows: 1

  steps:
    - id: backstage_post_request
      name: backstage post request
      action: http:backstage:request
      input:
        method: 'POST'
        path: '/devops-api/start-ec2'
        headers:
          content-type: 'application/json'
        body:
          env: ${{ parameters.envType }}
          instance_names: 
            - ${{ parameters.instanceNames }}

  output:
    postResponse: '{{ steps.backstage_post_request.output.body }}'
    postCode: '{{ steps.backstage_post_request.output.code }}'
    postHeaders: '{{ steps.backstage_post_request.output.headers }}'